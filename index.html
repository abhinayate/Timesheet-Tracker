<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KSN Intranet - Timesheet Tracker</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f7f8fa;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #003366;
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
    }
    main {
      max-width: 780px;
      margin: 30px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 20px 30px;
    }
    h2 {
      color: #003366;
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 500;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      background-color: #003366;
      color: white;
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      margin-top: 15px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background-color: #00509e;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #003366;
      color: white;
    }
    .total {
      text-align: right;
      font-weight: bold;
      padding-top: 10px;
      color: #003366;
    }
    .button-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
  </style>
</head>
<body>
  <header>KSN Intranet - Timesheet Tracker</header>
  <main>
    <h2>Daily Task Entry</h2>

    <label for="date">Date</label>
    <input type="date" id="date" />

    <label for="task">Task Description</label>
    <input type="text" id="task" placeholder="e.g., Document creation" />

    <label for="hours">Hours Spent</label>
    <input type="number" id="hours" placeholder="e.g., 4" min="0" step="0.5" />

    <div class="button-row">
      <button id="addTaskBtn">Add Task</button>
      <button id="downloadBtn">Download Log (CSV)</button>
    </div>

    <h2>Task Log</h2>
    <table id="taskTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Task</th>
          <th>Hours</th>
          <th>Time Logged</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="total" id="totalHours">Total Hours: 0</div>
  </main>

  <script>
    const addTaskBtn = document.getElementById("addTaskBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const taskInput = document.getElementById("task");
    const hoursInput = document.getElementById("hours");
    const dateInput = document.getElementById("date");
    const taskTableBody = document.querySelector("#taskTable tbody");
    const totalHoursDisplay = document.getElementById("totalHours");

    let totalHours = 0;
    let taskList = JSON.parse(localStorage.getItem("timesheetData") || "[]");

    function updateTable() {
      taskTableBody.innerHTML = "";
      totalHours = 0;

      taskList.forEach((task) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${task.date}</td>
          <td>${task.name}</td>
          <td>${task.hours}</td>
          <td>${task.time}</td>
        `;
        taskTableBody.appendChild(row);
        totalHours += Number(task.hours);
      });

      totalHoursDisplay.textContent = "Total Hours: " + totalHours;
    }

    addTaskBtn.addEventListener("click", () => {
      const date = dateInput.value;
      const taskName = taskInput.value.trim();
      const hours = parseFloat(hoursInput.value);

      if (!date || !taskName || isNaN(hours) || hours <= 0) {
        alert("Please enter date, task, and hours correctly.");
        return;
      }

      const newTask = {
        date: date,
        name: taskName,
        hours: hours,
        time: new Date().toLocaleTimeString(),
      };

      taskList.push(newTask);
      localStorage.setItem("timesheetData", JSON.stringify(taskList));

      // Optional: send to Google Sheets (once connected)
      // sendToGoogleSheet(newTask);

      taskInput.value = "";
      hoursInput.value = "";
      updateTable();
    });

    // Download CSV
    downloadBtn.addEventListener("click", () => {
      if (taskList.length === 0) {
        alert("No tasks to download!");
        return;
      }

      let csvContent = "data:text/csv;charset=utf-8,Date,Task,Hours,Time Logged\n";
      taskList.forEach(task => {
        csvContent += `${task.date},${task.name},${task.hours},${task.time}\n`;
      });

      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      const today = new Date().toISOString().split("T")[0];
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", `Timesheet_${today}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    // Load saved data
    updateTable();
  </script>
</body>
</html>
